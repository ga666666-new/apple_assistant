import{d as qe,i as Ie,u as xe,T as Ee,a0 as Re,v as Ue,h as u,k as te,c as Ne,aq as Ve,z as ze,ar as De,D as Me,f as Pe,o as T,w as s,e as a,s as w,aQ as Oe,aW as Ae,B as Be,x as p,t as l,b as c,ak as ae,aV as We,aX as je,aO as Je,aY as Ye,aZ as He,a as F,aR as Ke,a_ as Qe,m as P,al as Xe,F as Ze,r as Ge,ai as se,aS as ne,a$ as et,S as tt,y as at,n as st,b0 as nt,aN as ot,aU as lt,b1 as it,M as x,b2 as rt,b3 as ct,_ as dt}from"./index-lNCLxOJp.js";/* empty css              */import{v as oe}from"./v4-BWNhe68K.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import{u as ut}from"./loading-yRRlHpWB.js";const pt=["innerHTML"],mt={class:"saved-files-selector"},ft={key:0,class:"empty-state"},vt={key:1,class:"saved-files-list"},ht={class:"saved-files-header"},_t={class:"saved-files-grid"},yt=["onClick"],bt={class:"saved-file-info"},gt={class:"saved-file-meta"},Tt={key:0,class:"saved-file-desc"},wt={class:"saved-file-actions"},kt={key:0,class:"selected-indicator"},St={key:0,class:"selected-file-actions"},Ct={class:"upload-section"},Ft={key:0,class:"append-section"},Lt={class:"append-header"},$t={class:"upload-tip"},qt={class:"upload-tip"},It={class:"file-preview"},xt={name:"SearchTable"},Et=qe({...xt,setup(Rt){const le=Ie(),O=xe(),k=Ee(),{currentLocale:A}=Re(),ie=()=>({name:"",state:""}),{loading:re,setLoading:Q}=ut(!0),{t:i}=Ue.useI18n(),B=u([]),V=u(ie()),ce=u("medium"),d=te({inputText:""}),z=u("savedFiles"),L=u([]),S=u(null),D=u(!1),M=u(""),W=u(),j=u(),de=e=>{const{onProgress:t,onError:r,onSuccess:o,fileItem:h,name:q}=e,_=h.file.name.toLowerCase();if(!_.endsWith(".txt")&&!_.endsWith(".csv")){r(new Error(i("searchTable.query.fileTypeError")));return}const m=new FileReader;m.onload=y=>{const b=(y.target?.result).split(`
`).filter(f=>f.trim());d.inputText=b.join(`
`),o({content:d.inputText})},m.onerror=()=>{r(new Error(i("searchTable.query.fileReadError")))},m.readAsText(h.file,"utf-8")},ue=e=>{const{onProgress:t,onError:r,onSuccess:o,fileItem:h,name:q}=e,_=h.file.name.toLowerCase();if(!_.endsWith(".txt")&&!_.endsWith(".csv")){r(new Error(i("searchTable.query.fileTypeError")));return}const m=new FileReader;m.onload=y=>{const b=(y.target?.result).split(`
`).filter(g=>g.trim()),f=d.inputText?d.inputText.split(`
`).filter(g=>g.trim()):[],U=[...f,...b],v=Array.from(new Set(U));d.inputText=v.join(`
`);const C=b.length,I=b.length-(v.length-f.length);I>0?x.info(i("searchTable.query.appendResult",{added:C,duplicate:I,total:v.length})):x.success(i("searchTable.query.appendSuccess",{added:C,total:v.length})),o({content:d.inputText})},m.onerror=()=>{r(new Error(i("searchTable.query.fileReadError")))},m.readAsText(h.file,"utf-8")},X=te({...{current:1,pageSize:20}}),pe=Ne(()=>[{title:i("searchTable.columns.id"),dataIndex:"id"},{title:i("searchTable.columns.name"),dataIndex:"name"},{title:i("searchTable.columns.consume"),dataIndex:"consume",render:({record:e})=>`${e.consume} (${e.consume_usd} USD)`},{title:i("searchTable.columns.time_taken"),dataIndex:"time_taken"},{title:i("searchTable.columns.state"),dataIndex:"state",slotName:"state"},{title:i("searchTable.columns.operations"),dataIndex:"operations",slotName:"operations"}]),J=async()=>{Q(!0);try{const e=k.params.id||k.meta.id;if(!e){B.value=[];return}let r=(await rt(le.apikey)).filter(o=>o.type_id===e)[0].api_list;switch(V.value.name&&(r=r.filter(o=>o.name.toLowerCase().includes(V.value.name.toLowerCase()))),V.value.state&&(r=r.filter(o=>o.state===V.value.state)),A.value){case"zh-CN":break;case"en-US":r=r.map(o=>({...o,name:o.name_en}));break;default:break}B.value=r,X.total=r.length}catch{}finally{Q(!1)}},me=e=>{J()};J(),Ve(()=>A,(e,t)=>{J()},{deep:!0});const $=u(!1),Y=u(""),H=u(""),fe=e=>{switch($.value=!0,Y.value=e.id,console.log("📱 打开查询模态框，刷新数据集列表"),R(),setTimeout(()=>{console.log("📋 模态框数据准备完成，当前数据集数量:",L.value.length)},100),A.value){case"zh-CN":H.value=e.the;break;case"en-US":H.value=e.the_en;break}},ve=()=>{$.value=!1;const e=d.inputText.replace(/\r/g,"").split(`
`).filter(t=>t.trim());if(e.length!==0)try{const t=oe();typeof localStorage<"u"&&localStorage.setItem(t,JSON.stringify(e));const r=k.params.id||k.meta.id;O.push({name:"Result",query:{id:t,serviceId:Y.value,typeId:r}})}catch(t){console.error("❌ 处理查询数据时出错:",t)}},he=()=>{$.value=!1,d.inputText="",z.value="savedFiles",S.value=null,typeof window<"u"&&window.arcoUploadRefs&&Object.values(window.arcoUploadRefs).forEach(e=>{e&&e.reset&&e.reset()}),W.value&&W.value.reset(),j.value&&j.value.reset()},_e=e=>{z.value=e},R=()=>{try{if(typeof localStorage>"u"){console.warn("⚠️ localStorage不可用，无法加载数据集"),L.value=[];return}const e=JSON.parse(localStorage.getItem("savedFiles")||"[]");console.log("查询页面加载数据集:",{timestamp:new Date().toLocaleString(),count:e.length,datasets:e.map(t=>({id:t.id,name:t.name,totalLines:t.totalLines}))}),L.value=e}catch(e){console.error("加载已保存数据集时出错:",e),L.value=[]}},ye=()=>{console.log("手动刷新数据集列表"),R()},be=e=>{S.value=e},ge=()=>{S.value=null},Te=e=>new Date(e).toLocaleString(),we=e=>{const t=e.data.slice(0,10);M.value=t.join(`
`),e.data.length>10&&(M.value+=`

... 还有 ${e.data.length-10} 行数据`),D.value=!0},ke=()=>{if(S.value){$.value=!1;try{const e=oe();typeof localStorage<"u"&&localStorage.setItem(e,JSON.stringify(S.value.data));const t=k.params.id||k.meta.id;O.push({name:"Result",query:{id:e,serviceId:Y.value,typeId:t}})}catch(e){console.error("❌ 使用已保存数据集时出错:",e)}}},Se=e=>{const t=document.createElement("input");t.type="file",t.accept=".txt,.csv",t.style.display="none",t.onchange=r=>{const o=r.target.files[0];if(!o)return;const h=o.name.toLowerCase();if(!h.endsWith(".txt")&&!h.endsWith(".csv")){x.error(i("searchTable.query.fileTypeError"));return}const q=new FileReader;q.onload=_=>{const y=(_.target?.result).split(`
`).filter(v=>v.trim()),E=e.data,b=[...E,...y],f=Array.from(new Set(b)),U={...e,data:f,totalLines:f.length,updatedAt:Date.now()};try{const C=JSON.parse(localStorage.getItem("savedFiles")||"[]").map(N=>N.id===e.id?U:N);localStorage.setItem("savedFiles",JSON.stringify(C)),L.value=C;const I=y.length,g=y.length-(f.length-E.length);g>0?x.success(i("searchTable.savedFiles.appendResult",{fileName:e.name,added:I,duplicate:g,total:f.length})):x.success(i("searchTable.savedFiles.appendSuccess",{fileName:e.name,added:I,total:f.length})),typeof window<"u"&&window.dispatchEvent(new CustomEvent("savedFilesUpdated",{detail:{action:"append",fileId:e.id}}))}catch(v){console.error("❌ 追加文件时出错:",v),x.error(i("searchTable.savedFiles.appendError"))}},q.onerror=()=>{x.error(i("searchTable.query.fileReadError"))},q.readAsText(o,"utf-8")},document.body.appendChild(t),t.click(),document.body.removeChild(t)},Ce=()=>{$.value=!1,O.push("/file-manager/import")},Z=e=>{console.log("收到数据集更新事件:",e.detail),R()},G=()=>{typeof document<"u"&&!document.hidden&&(console.log("页面重新可见，刷新数据集"),R())};return ze(()=>{try{typeof window<"u"&&window.addEventListener("savedFilesUpdated",Z),typeof document<"u"&&document.addEventListener("visibilitychange",G),R()}catch(e){console.error("❌ 查询页面挂载时出错:",e)}}),De(()=>{try{typeof window<"u"&&window.removeEventListener("savedFilesUpdated",Z),typeof document<"u"&&document.removeEventListener("visibilitychange",G)}catch(e){console.error("❌ 查询页面卸载时出错:",e)}}),(e,t)=>{const r=Me("Breadcrumb"),o=Be,h=Ae,q=Oe,_=je,m=Je,y=Qe,E=Ke,b=Xe,f=et,U=tt,v=He,C=nt,I=ot,g=st,N=lt,Fe=at,Le=Ye,ee=We,$e=ct;return T(),Pe($e,{content:["17604515707@163.com",w(it)().format("YYYY-MM-DD")],font:{color:"rgba(255, 0, 0, 0.3)",fontSize:16}},{default:s(()=>[a(r,{items:["menu.list",`menu.list.${w(k).meta.id}`]},null,8,["items"]),a(q,{class:"general-card",title:e.$t(`menu.list.${w(k).meta.id}`)},{default:s(()=>[a(h,{"row-key":"id",loading:w(re),pagination:X,columns:pe.value,data:B.value,bordered:!1,size:ce.value,onPageChange:me},{state:s(({record:n})=>[c("span",{class:ae(["circle",n.state==="1"?"pass":""])},null,2),p(" "+l(e.$t(`searchTable.form.state.${n.state==="1"?"active":"inactive"}`)),1)]),operations:s(({record:n})=>[a(o,{type:"text",size:"small",onClick:K=>fe(n)},{default:s(()=>[p(l(e.$t("searchTable.columns.operations.use")),1)]),_:2},1032,["onClick"])]),_:1},8,["loading","pagination","columns","data","size"])]),_:1},8,["title"]),a(ee,{visible:$.value,"onUpdate:visible":t[2]||(t[2]=n=>$.value=n),onOk:ve,onCancel:he,width:"900px"},{title:s(()=>[p(l(e.$t("searchTable.query.title")),1)]),default:s(()=>[c("div",null,[a(_,{style:{height:"200px",overflow:"auto"}},{default:s(()=>[c("div",{innerHTML:H.value},null,8,pt)]),_:1}),a(m),a(Le,{"active-key":z.value,"onUpdate:activeKey":t[1]||(t[1]=n=>z.value=n),onChange:_e},{default:s(()=>[a(v,{key:"savedFiles",title:e.$t("searchTable.savedFiles.title")},{default:s(()=>[c("div",mt,[L.value.length===0?(T(),F("div",ft,[a(E,{description:e.$t("searchTable.savedFiles.empty")},{image:s(()=>[a(y)]),extra:s(()=>[a(o,{type:"primary",onClick:Ce},{default:s(()=>[p(l(e.$t("searchTable.savedFiles.goUpload")),1)]),_:1})]),_:1},8,["description"])])):(T(),F("div",vt,[c("div",ht,[c("span",null,l(e.$t("searchTable.savedFiles.selectTip")),1),a(o,{size:"mini",onClick:ye},{default:s(()=>[a(b),p(" "+l(e.$t("searchTable.savedFiles.refresh")),1)]),_:1})]),c("div",_t,[(T(!0),F(Ze,null,Ge(L.value,n=>(T(),F("div",{key:n.id,class:ae(["saved-file-card",{selected:S.value?.id===n.id}]),onClick:K=>be(n)},[c("div",bt,[c("h4",null,l(n.name),1),c("div",gt,[c("span",null,l(e.$t("searchTable.savedFiles.totalLines"))+": "+l(n.totalLines),1),c("span",null,l(Te(n.createdAt)),1)]),n.description?(T(),F("div",Tt,l(n.description),1)):P("",!0)]),c("div",wt,[a(o,{size:"mini",type:"text",onClick:se(K=>we(n),["stop"])},{default:s(()=>[p(l(e.$t("searchTable.savedFiles.preview")),1)]),_:2},1032,["onClick"]),a(o,{size:"mini",type:"text",onClick:se(K=>Se(n),["stop"])},{default:s(()=>[a(w(ne)),p(" "+l(e.$t("searchTable.savedFiles.append")),1)]),_:2},1032,["onClick"])]),S.value?.id===n.id?(T(),F("div",kt,[a(f)])):P("",!0)],10,yt))),128))]),S.value?(T(),F("div",St,[a(m),a(U,null,{default:s(()=>[a(o,{type:"primary",onClick:ke},{default:s(()=>[p(l(e.$t("searchTable.savedFiles.use")),1)]),_:1}),a(o,{onClick:ge},{default:s(()=>[p(l(e.$t("searchTable.savedFiles.clearSelection")),1)]),_:1})]),_:1})])):P("",!0)]))])]),_:1},8,["title"]),a(v,{key:"manual",title:e.$t("searchTable.query.manualInput")},{default:s(()=>[a(Fe,{model:d},{default:s(()=>[a(g,{label:w(i)("searchTable.query.uploadFile")},{default:s(()=>[c("div",Ct,[a(C,{limit:1,"custom-request":de,accept:".txt,.csv","show-file-list":!0,ref_key:"uploadRef",ref:W},{default:s(()=>[a(o,{type:"outline"},{default:s(()=>[p(l(e.$t("searchTable.query.selectFile")),1)]),_:1})]),_:1},512),d.inputText?(T(),F("div",Ft,[a(m),c("div",Lt,[c("span",null,l(e.$t("searchTable.query.appendFile")),1),a(I,{color:"blue"},{default:s(()=>[p(l(d.inputText.split(`
`).filter(n=>n.trim()).length)+" "+l(e.$t("searchTable.query.currentLines")),1)]),_:1})]),a(C,{limit:1,"custom-request":ue,accept:".txt,.csv","show-file-list":!0,ref_key:"appendUploadRef",ref:j},{default:s(()=>[a(o,{type:"outline",size:"small"},{default:s(()=>[a(w(ne)),p(" "+l(e.$t("searchTable.query.appendFile")),1)]),_:1})]),_:1},512),c("div",$t,l(e.$t("searchTable.query.appendTip")),1)])):P("",!0)]),c("div",qt,l(e.$t("searchTable.query.uploadTip")),1)]),_:1},8,["label"]),a(g,{label:w(i)("searchTable.query.input")},{default:s(()=>[a(N,{modelValue:d.inputText,"onUpdate:modelValue":t[0]||(t[0]=n=>d.inputText=n),rows:6,placeholder:w(i)("searchTable.query.inputPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["active-key"])])]),_:1},8,["visible"]),a(ee,{visible:D.value,"onUpdate:visible":t[5]||(t[5]=n=>D.value=n),title:e.$t("searchTable.savedFiles.previewTitle"),width:"600px"},{footer:s(()=>[a(o,{onClick:t[4]||(t[4]=n=>D.value=!1)},{default:s(()=>[p(l(e.$t("searchTable.savedFiles.closePreview")),1)]),_:1})]),default:s(()=>[c("div",It,[a(N,{modelValue:M.value,"onUpdate:modelValue":t[3]||(t[3]=n=>M.value=n),rows:10,readonly:""},null,8,["modelValue"])])]),_:1},8,["visible","title"])]),_:1},8,["content"])}}}),jt=dt(Et,[["__scopeId","data-v-d2963979"]]);export{jt as default};
